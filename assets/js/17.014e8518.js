(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{497:function(_,v,t){_.exports=t.p+"assets/img/ipconfig-demo.feebd8a8.png"},544:function(_,v,t){"use strict";t.r(v);var a=t(1),r=Object(a.a)({},(function(){var _=this,v=_._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("h2",{attrs:{id:"ipconfig-window-ifconfig-linux"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#ipconfig-window-ifconfig-linux"}},[_._v("#")]),_._v(" ipconfig(window)/ifconfig(Linux)")]),_._v(" "),v("p",[v("img",{attrs:{src:t(497),alt:""}})]),_._v(" "),v("p",[_._v("IP 地址是一个网卡在网络世界的通讯地址，相当于我们现实世界的门牌号码。")]),_._v(" "),v("p",[_._v("10.8.59.110 就是一个 IP 地址。这个地址被点分隔为四个部分，每个部分 8 个 bit，所以 IP 地址总共是 32 位。因为不够用，于是就有了 IPv6，也就是上面输出结果里面 IPv6 fe80::219a:694d:f645:1f9a%17。这个有 128 位，")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://static001.geekbang.org/resource/image/fa/5e/fa9a00346b8a83a84f4c00de948a5b5e.jpg",alt:""}})]),_._v(" "),v("p",[_._v("在网络地址中，至少在当时设计的时候，对于 A、B、 C 类主要分两部分，前面一部分是网络号，后面一部分是主机号。")]),_._v(" "),v("p",[_._v("下面这个表格，详细地展示了 A、B、C 三类地址所能包含的主机的数量。")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://static001.geekbang.org/resource/image/6d/4c/6de9d39a68520c8e3b75aa919fadb24c.jpg",alt:""}})]),_._v(" "),v("p",[_._v("这里面有个尴尬的事情，就是 C 类地址能包含的最大主机数量实在太少了，只有 254 个。当时设计的时候恐怕没想到，现在估计一个网吧都不够用吧。而 B 类地址能包含的最大主机数量又太多了。6 万多台机器放在一个网络下面，一般的企业基本达不到这个规模，闲着的地址就是浪费。")]),_._v(" "),v("h3",{attrs:{id:"_1-无类型域间选路-cidr"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_1-无类型域间选路-cidr"}},[_._v("#")]),_._v(" 1.无类型域间选路（CIDR）")]),_._v(" "),v("p",[_._v("于是有了一个折中的方式叫作"),v("strong",[_._v("无类型域间选路")]),_._v("，简称"),v("strong",[_._v("CIDR")]),_._v("。这种方式打破了原来设计的几类地址的做法，将 32 位的 IP 地址一分为二，前面是"),v("strong",[_._v("网络号")]),_._v("，后面是"),v("strong",[_._v("主机号")]),_._v("。从哪里分呢？你如果注意观察的话可以看到，10.100.122.2/24，这个 IP 地址中有一个斜杠，斜杠后面有个数字 24。这种地址表示形式，就是 CIDR。后面 24 的意思是，32 位中，前 24 位是网络号，后 8 位是主机号。")]),_._v(" "),v("p",[_._v("伴随着 CIDR 存在的，一个是"),v("strong",[_._v("广播地址")]),_._v("，10.100.122.255。如果发送这个地址，所有 10.100.122 网络里面的机器都可以收到。另一个是"),v("strong",[_._v("子网掩码")]),_._v("，255.255.255.0。")]),_._v(" "),v("p",[_._v("将子网掩码和 IP 地址进行 AND 计算。前面三个 255，转成二进制都是 1。1 和任何数值取 AND，都是原来数值，因而前三个数不变，为 10.100.122。后面一个 0，转换成二进制是 0，0 和任何数值取 AND，都是 0，因而最后一个数变为 0，合起来就是 10.100.122.0。这就是"),v("strong",[_._v("网络号")]),_._v("。"),v("strong",[_._v("将子网掩码和 IP 地址按位计算 AND，就可得到网络号。")])]),_._v(" "),v("h3",{attrs:{id:"_2-举例-一个容易-犯错-的-cidr"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_2-举例-一个容易-犯错-的-cidr"}},[_._v("#")]),_._v(" 2.举例：一个容易“犯错”的 CIDR")]),_._v(" "),v("p",[_._v("我们来看 16.158.165.91/22 这个 CIDR。求一下这个网络的第一个地址、子网掩码和广播地址。")]),_._v(" "),v("p",[_._v("你要是上来就写 16.158.165.1，那就大错特错了。")]),_._v(" "),v("p",[_._v("/22 不是 8 的整数倍，不好办，只能先变成二进制来看。16.158 的部分不会动，它占了前 16 位。中间的 165，变为二进制为 ‭10100101‬。除了前面的 16 位，还剩 6 位。所以，这 8 位中前 6 位是网络号，16.158.<101001>，而<01>.91 是机器号。")]),_._v(" "),v("p",[_._v("第一个地址是 16.158.<101001><00>.1，即 16.158.164.1。子网掩码是 255.255.<111111><00>.0，即 255.255.252.0。广播地址为 16.158.<101001><11>.255，即 16.158.167.255。")]),_._v(" "),v("p",[_._v("这五类地址中，还有一类 D 类是"),v("strong",[_._v("组播地址")]),_._v("。使用这一类地址，属于某个组的机器都能收到。这有点类似在公司里面大家都加入了一个邮件组。发送邮件，加入这个组的都能收到。组播地址在后面讲述 VXLAN 协议的时候会提到。")]),_._v(" "),v("p",[_._v("讲了这么多，才讲了上面的输出结果中很小的一部分，是不是觉得原来并没有真的理解 ip addr 呢？我们接着来分析。")]),_._v(" "),v("p",[_._v("在 IP 地址的后面有个 scope，对于 eth0 这张网卡来讲，是 global，说明这张网卡是可以对外的，可以接收来自各个地方的包。对于 lo 来讲，是 host，说明这张网卡仅仅可以供本机相互通信。")]),_._v(" "),v("p",[_._v("lo 全称是"),v("strong",[_._v("loopback")]),_._v("，又称"),v("strong",[_._v("环回接口")]),_._v("，往往会被分配到 127.0.0.1 这个地址。这个地址用于本机通信，经过内核处理后直接返回，不会在任何网络中出现。")]),_._v(" "),v("h3",{attrs:{id:"_3-mac-地址"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_3-mac-地址"}},[_._v("#")]),_._v(" 3.MAC 地址")]),_._v(" "),v("p",[_._v("在 IP 地址的上一行是 link/ether fa:16:3e:c7:79:75 brd ff:ff:ff:ff:ff:ff，这个被称为"),v("strong",[_._v("MAC 地址")]),_._v("，是一个网卡的物理地址，用十六进制，6 个 byte 表示。")]),_._v(" "),v("p",[_._v("MAC 地址是一个很容易让人“误解”的地址。因为 MAC 地址号称全局唯一，不会有两个网卡有相同的 MAC 地址，而且网卡自生产出来，就带着这个地址。很多人看到这里就会想，既然这样，整个互联网的通信，全部用 MAC 地址好了，只要知道了对方的 MAC 地址，就可以把信息传过去。")]),_._v(" "),v("p",[_._v("这样当然是不行的。 "),v("strong",[_._v("一个网络包要从一个地方传到另一个地方，除了要有确定的地址，还需要有定位功能。")]),_._v(" 而有门牌号码属性的 IP 地址，才是有远程定位功能的。")]),_._v(" "),v("p",[_._v("例如，你去杭州市网商路 599 号 B 楼 6 层找刘超，你在路上问路，可能被问的人不知道 B 楼是哪个，但是可以给你指网商路怎么去。但是如果你问一个人，你知道这个身份证号的人在哪里吗？可想而知，没有人知道。")]),_._v(" "),v("p",[_._v("MAC 地址更像是身份证，是一个唯一的标识。")]),_._v(" "),v("p",[_._v("它的唯一性设计是为了组网的时候，不同的网卡放在一个网络里面的时候，可以不用担心冲突。从硬件角度，保证不同的网卡有不同的标识。")]),_._v(" "),v("p",[_._v("MAC 地址是有一定定位功能的，只不过范围非常有限。你可以根据 IP 地址，找到杭州市网商路 599 号 B 楼 6 层，但是依然找不到我，你就可以靠吼了，大声喊身份证 XXXX 的是哪位？我听到了，我就会站起来说，是我啊。但是如果你在上海，到处喊身份证 XXXX 的是哪位，我不在现场，当然不会回答，因为我在杭州不在上海。")]),_._v(" "),v("p",[_._v("所以，MAC 地址的通信范围比较小，局限在一个子网里面。例如，从 192.168.0.2/24 访问 192.168.0.3/24 是可以用 MAC 地址的。一旦跨子网，即从 192.168.0.2/24 到 192.168.1.2/24，MAC 地址就不行了，需要 IP 地址起作用了。")]),_._v(" "),v("h3",{attrs:{id:"_4-小结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-小结"}},[_._v("#")]),_._v(" 4.小结")]),_._v(" "),v("p",[_._v("怎么样，看起来很简单的一个命令，里面学问很大吧？通过这一节，希望你能记住以下的知识点，后面都能用得上：")]),_._v(" "),v("ul",[v("li",[v("p",[_._v("IP 是地址，有定位功能；MAC 是身份证，无定位功能；")])]),_._v(" "),v("li",[v("p",[_._v("CIDR 可以用来判断是不是本地人；")])]),_._v(" "),v("li",[v("p",[_._v("IP 分公有的 IP 和私有的 IP。后面的章节中我会谈到“出国门”，就与这个有关。")])])])])}),[],!1,null,null,null);v.default=r.exports}}]);